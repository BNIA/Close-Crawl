{% extends 'datato/components/base.html' %}
{% load static from staticfiles %}
{% load jsonify %}

{% block nav-options %}{% endblock %}

{% block home-url %}{% url 'index' %}{% endblock %}

{% block content %}

    <section class="bg-primary" id="about" style="background-color: #00a79d;">
    <div class="container">


        <div class="plot" id="plotdiv"></div>

        Feature 1:
        <label>
            <select id="feature1" style="color: black"
                    onchange="generatePlotlyGraph()"></select>
        </label>

        Feature 2:
        <label>
            <select id="feature2" style="color: black;"
                    onchange="generatePlotlyGraph()"></select>
        </label>

    </div>


{% endblock %}

{% block extra_js %}
    <script>

        /* Preperation, connecting and setting variables*/
        var json_dataset = {{ json_dataset | jsonify }};
        var features = Object.keys(json_dataset);
        var first_dropdown = document.getElementById("feature1");
        var second_dropdown = document.getElementById("feature2");
        var plot_graph = document.getElementById("plotdiv");


        /* Function serves as a creating the dyanmic options list */
        function fillFeatures(dropdown, arrayOfFeatures) {
            for (var i = 0; i < arrayOfFeatures.length; i++) {
                var option = document.createElement("option");
                option.value = i;
                option.textContent = features[i];
                dropdown.add(option);
            }
        }

        /*
         * Serves as a bootstrap for parsing values that are selected
         */
        function generatePlotlyGraph() {
            var first_sel_index = first_dropdown.options.selectedIndex;
            var first_option = first_dropdown.options[first_sel_index].text;

            var second_sel_index = second_dropdown.options.selectedIndex;
            var second_option = second_dropdown.options[second_sel_index].text;

            createPlotly(first_option, second_option);
        }

        /*
         * Actually creates the plot, don't have to clear because ??
         */
        function createPlotly(first_text, second_text) {

            // Translating dictionary into arrays
            arrayFirst = Object.values(json_dataset[first_text]);
            arraySecond = Object.values(json_dataset[second_text]);

            var trace1 = {
                x: arrayFirst,
                y: arraySecond,
                mode: 'markers'
            };

            var data = [trace1];

            var ourTitle = first_text + " x " + second_text;
            
            var layout = {
                title: ourTitle
            };

            Plotly.newPlot('plotdiv', data, layout);
        }

        /* Bootstraps for filling data on the options list*/
        fillFeatures(first_dropdown, features);
        fillFeatures(second_dropdown, features);

        /* Generating a default polygraph*/
        generatePlotlyGraph();
    </script>

{% endblock %}
